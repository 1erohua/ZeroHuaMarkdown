# å‰è¨€
å®¢æˆ·ç«¯åœ¨å®¿ä¸»æœºï¼ŒæœåŠ¡å™¨åœ¨dockeré‡Œé¢ã€‚
å…¶ä¸­å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„ç«¯ç‚¹æ˜ å°„ä¸º 8080:80
**å› è€Œå®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨è¿›è¡Œè®¿é—®ï¼Œå®é™…ä¸Šæ˜¯è®¿é—® 127.0.0.1:8080**
**æœåŠ¡å™¨è‡ªèº«åˆ™æ˜¯ç›‘å¬80ç«¯å£,å¹¶ä¸”dockerçš„IPæ˜¯172.17.0.2**



# ä¸€ã€ç»ˆç«¯èŠ‚ç‚¹çš„åˆ›å»º
#### å®¢æˆ·ç«¯
```cpp
// ç»ˆç«¯èŠ‚ç‚¹åˆ›å»º  
int client_and_point() {  
  
    // å‡è®¾å®¢æˆ·ç«¯å·²ç»è·å–äº†æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·  
    // ä»¥å®¹å™¨ä½œä¸ºæœåŠ¡å™¨  
    std::string raw_ip_address = "172.17.0.2"; // å®¹å™¨çš„åœ°å€  
    unsigned short port_num = 80; // å®¹å™¨ç«¯å£  
  
    boost::system::error_code ec;  
  
    // å°†å­—ç¬¦ä¸²å½¢å¼çš„IPåœ°å€è§£æä¸ºasio::ip::addresså¯¹è±¡  
    asio::ip::address ip_address = asio::ip::address::from_string(raw_ip_address, ec);  
  
    // æ•è·å¯èƒ½ä¼šå‘ç”Ÿçš„é”™è¯¯  
    if (ec.value() != 0) {  
        std::cout << "error to find the target" << std::endl;  
        std::cout << "é”™è¯¯ä»£ç ï¼š" << ec.value() << std::endl;  
    }  
  
    // åˆ›å»ºä¸€ä¸ªç«¯ç‚¹å¯¹è±¡ç”¨æˆ·åç»­é€šä¿¡  
    asio::ip::tcp::endpoint endpoint(ip_address, port_num);  
  
    return  0;  
}

```
1. **Step 1: è·å–IPåœ°å€å’Œç«¯å£å·**
    
    - ä»£ç å‡è®¾å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå·²ç»è·å–äº†æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ã€‚è¿™é‡Œä½¿ç”¨äº†æœ¬åœ°å›ç¯åœ°å€Â `172.17.0.2`Â å’Œç«¯å£å·Â `80`ã€‚
        
2. **Step 2: è§£æIPåœ°å€**
    
    - ä½¿ç”¨Â `asio::ip::address::from_string`Â å‡½æ•°å°†å­—ç¬¦ä¸²å½¢å¼çš„IPåœ°å€è§£æä¸ºÂ `asio::ip::address`Â å¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°æ”¯æŒIPv4å’ŒIPv6åœ°å€ã€‚
        
    - `boost::system::error_code ec`Â ç”¨äºæ•è·è§£æè¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ã€‚å¦‚æœè§£æå¤±è´¥ï¼Œ`ec`Â ä¼šåŒ…å«é”™è¯¯ä»£ç å’Œé”™è¯¯ä¿¡æ¯ã€‚
        
3. **Step 3: åˆ›å»ºç«¯ç‚¹**
    
    - ä½¿ç”¨è§£æåçš„IPåœ°å€å’Œç«¯å£å·åˆ›å»ºÂ `asio::ip::tcp::endpoint`Â å¯¹è±¡ã€‚è¿™ä¸ªç«¯ç‚¹å¯¹è±¡è¡¨ç¤ºå®¢æˆ·ç«¯å°†è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚
        
4. **Step 4: ä½¿ç”¨ç«¯ç‚¹**
    
    - åˆ›å»ºå¥½çš„ç«¯ç‚¹å¯ä»¥ç”¨äºåç»­çš„ç½‘ç»œé€šä¿¡æ“ä½œï¼Œä¾‹å¦‚è¿æ¥åˆ°æœåŠ¡å™¨ã€‚


#### æœåŠ¡å™¨
```cpp
#include <boost/asio.hpp>  
#include <string>  
#include <iostream>  
using namespace boost;  
  
// ç»ˆç«¯èŠ‚ç‚¹çš„åˆ›å»º  
int server_end_point(){  
    unsigned short port_num = 80; // æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œå› è€Œåªéœ€è¦åˆ—å‡ºç›‘å¬çš„ç«¯å£ï¼Œä¸ç”¨åœ¨æ„å®¢æˆ·ç«¯çš„IPåœ°å€  
  
    // åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºæ‰€æœ‰å¯ç”¨ipv6åœ°å€çš„å¯¹è±¡ï¼Œå³æœåŠ¡å™¨ç›‘å¬æ‰€æœ‰å¯ç”¨çš„ipv6ç½‘ç»œæ¥å£  
    asio::ip::address ip_adderss = asio::ip::address_v6::any();  
  
    // åˆ›å»ºç«¯ç‚¹å¯¹è±¡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å°†è¦ç›‘å¬çš„åœ°å€å’Œç«¯å£  
    // ç›‘å¬æ‰€æœ‰ç½‘ç»œåœ°å€çš„80ç«¯å£  
    asio::ip::tcp::endpoint endpoint(ip_adderss, port_num);  
  
    return 0;  
}

```

1. **Step 1: è·å–ç«¯å£å·**
    
    - ä»£ç å‡è®¾æœåŠ¡å™¨åº”ç”¨ç¨‹åºå·²ç»è·å–äº†è¦ç›‘å¬çš„ç«¯å£å·ã€‚è¿™é‡Œä½¿ç”¨äº†ç«¯å£å·Â `80`ã€‚
        
2. **Step 2: åˆ›å»ºIPåœ°å€å¯¹è±¡**
    
    - ä½¿ç”¨Â `asio::ip::address_v6::any()`Â åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºæ‰€æœ‰å¯ç”¨IPv6åœ°å€çš„Â `asio::ip::address`Â å¯¹è±¡ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨å°†ç›‘å¬æ‰€æœ‰å¯ç”¨çš„IPv6ç½‘ç»œæ¥å£ã€‚
        
3. **Step 3: åˆ›å»ºç«¯ç‚¹**
    
    - ä½¿ç”¨IPåœ°å€å’Œç«¯å£å·åˆ›å»ºÂ `asio::ip::tcp::endpoint`Â å¯¹è±¡ã€‚è¿™ä¸ªç«¯ç‚¹å¯¹è±¡è¡¨ç¤ºæœåŠ¡å™¨å°†è¦ç›‘å¬çš„åœ°å€å’Œç«¯å£ã€‚
        
4. **Step 4: ä½¿ç”¨ç«¯ç‚¹**
    
    - åˆ›å»ºå¥½çš„ç«¯ç‚¹å¯ä»¥ç”¨äºåç»­çš„ç½‘ç»œé€šä¿¡æ“ä½œï¼Œä¾‹å¦‚ç»‘å®šåˆ°å¥—æ¥å­—å¹¶å¼€å§‹ç›‘å¬ä¼ å…¥çš„è¿æ¥ã€‚



# äºŒã€åˆ›å»ºsocket
### å®¢æˆ·ç«¯

```cpp

int create_tcp_socket() {  
    // åˆ›å»ºsocketçš„æµç¨‹(å®¢æˆ·ç«¯ï¼‰  
    // 1ã€åˆ›å»ºä¸Šä¸‹æ–‡iocontext  
    asio::io_context io_context;  
  
    // 2ã€é€‰æ‹©åè®®  
    asio::ip::tcp protocol  = asio::ip::tcp::v4();  
  
    // 3.å®ä¾‹åŒ–  
    asio::ip::tcp::socket sock(io_context); // æ—¢ç„¶æ˜¯tcpé‚£ä¹ˆå°±æŒ‰ç…§tcpçš„è¿æ³•ï¼Œå³tcp::socket  
  
    // 4.æ‰“å¼€socket  
    boost::system::error_code ec;  
    sock.open(protocol, ec);  
  
    if (ec.value() != 0) {  
        std::cout << "error to open socket" << std::endl;  
        std::cout << ec.message() << std::endl;  
    }  
    return 0;  
}

```
### æœåŠ¡å™¨
```cpp  
// socketçš„åˆ›å»º  
int create_acceptor_socket() {  
    // 1  
    asio::io_context ios;  
  
    // 2  
    asio::ip::tcp protocol = asio::ip::tcp::v6();  
  
    // 3  
    asio::ip::tcp::acceptor acceptor(ios);  
  
    boost::system::error_code ec;  
  
    // 4  
    acceptor.open(protocol,ec);  
  
    if (ec.value() != 0) {  
        std::cout << "å‡ºé”™äº†" << std::endl;  
        std::cout << "error message" << ec.message() << std::endl;  
    }  
  
    return  0;  
}
```
ä»¥ä¸‹æ˜¯å…³äºè¿™ä¸¤æ®µC++ç½‘ç»œç¼–ç¨‹ä»£ç çš„è¯¦ç»†è§£æï¼š

---

### ä¸€ã€æ ¸å¿ƒæ¦‚å¿µä¸ä»£ç è§£æ
#### 1. **`create_tcp_socket()` å‡½æ•°ï¼šåˆ›å»ºé€šä¿¡Socket**
**ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªç”¨äºæ•°æ®é€šä¿¡çš„TCP Socketï¼ˆå®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯è¿æ¥åçš„æ•°æ®ä¼ è¾“ï¼‰ã€‚

**ä»£ç é€å±‚è§£æ**ï¼š
1. **`asio::io_context ios`**  
   - `io_context` æ˜¯ Asio åº“çš„äº‹ä»¶å¾ªç¯æ ¸å¿ƒï¼Œè´Ÿè´£åˆ†å‘I/Oäº‹ä»¶ï¼ˆå¦‚Socketè¯»å†™ã€å®šæ—¶å™¨ï¼‰ã€‚  
   - æ¯ä¸ªSocketå¿…é¡»ç»‘å®šä¸€ä¸ª `io_context`ã€‚ä½†æ­¤å¤„ä»£ç æ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½æ–°å»º `io_context`ï¼Œå®é™…é¡¹ç›®ä¸­é€šå¸¸å…¨å±€å…±äº«ä¸€ä¸ªå®ä¾‹ä»¥æé«˜æ•ˆç‡ã€‚

2. **`asio::ip::tcp protocol = asio::ip::tcp::v4()`**  
   - å®šä¹‰ä½¿ç”¨ TCP over IPv4 åè®®ã€‚è‹¥éœ€ IPv6ï¼Œå¯ç”¨ `tcp::v6()`ã€‚

3. **`asio::ip::tcp::socket sock(ios)`**  
   - åˆ›å»ºæœªæ‰“å¼€çš„Socketå¯¹è±¡ï¼Œå…³è”åˆ° `io_context`ã€‚æ­¤æ—¶Socketæœªç»‘å®šåè®®æˆ–åœ°å€ã€‚

4. **`sock.open(protocol, ec)`**  
   - æ‰“å¼€Socketå¹¶ç»‘å®šåˆ°æŒ‡å®šåè®®ï¼ˆIPv4ï¼‰ã€‚  
   - `error_code ec` ç”¨äºéå¼‚å¸¸é”™è¯¯å¤„ç†ï¼Œé¿å…ç¨‹åºå´©æºƒã€‚

**å…³é”®ç‚¹**ï¼š
- æ­¤Socketæ˜¯â€œä¸»åŠ¨â€çš„ï¼Œå¯ç”¨äº `connect()`ï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ–æ•°æ®è¯»å†™ï¼ˆæœåŠ¡ç«¯å·²æ¥å—çš„è¿æ¥ï¼‰ã€‚
- æœªç»‘å®šåœ°å€å’Œç«¯å£ï¼Œéœ€åç»­æ“ä½œï¼ˆå¦‚ `connect` æˆ– `bind`ï¼‰ã€‚

---

#### 2. **`create_acceptor_socket()` å‡½æ•°ï¼šåˆ›å»ºç›‘å¬Socket**
**ä½œç”¨**ï¼šåˆ›å»ºä¸€ä¸ªç”¨äºæ¥æ”¶æ–°è¿æ¥çš„ Acceptor Socketï¼ˆæœåŠ¡ç«¯ä¸“ç”¨ï¼‰ã€‚

**ä»£ç é€å±‚è§£æ**ï¼š
1. **`asio::ip::tcp protocol = asio::ip::tcp::v6()`**  
   - ä½¿ç”¨ TCP over IPv6 åè®®ã€‚

2. **`asio::ip::tcp::acceptor acceptor(ios)`**  
   - åˆ›å»º Acceptor å¯¹è±¡ï¼Œä¸“é—¨ç”¨äºç›‘å¬å’Œæ¥å—è¿æ¥è¯·æ±‚ã€‚

3. **`acceptor.open(protocol, ec)`**  
   - æ‰“å¼€ Acceptor å¹¶ç»‘å®šåˆ°åè®®ï¼ˆIPv6ï¼‰ã€‚

**å…³é”®ç‚¹**ï¼š
- Acceptor å¿…é¡»ç»‘å®šåˆ°ç‰¹å®šç«¯å£å¹¶è¿›å…¥ç›‘å¬çŠ¶æ€æ‰èƒ½å·¥ä½œï¼ˆä»£ç ä¸­ç¼ºå¤±ï¼‰ã€‚
- å®é™…ä½¿ç”¨éœ€è¡¥å…… `bind()` å’Œ `listen()` æ­¥éª¤ï¼š
  ```cpp
  // ç»‘å®šåˆ°ç«¯å£ 8080
  asio::ip::tcp::endpoint endpoint(asio::ip::address_v6::any(), 8080);
  acceptor.bind(endpoint, ec);
  // è¿›å…¥ç›‘å¬çŠ¶æ€
  acceptor.listen(asio::socket_base::max_listen_connections, ec);
  ```

---

### äºŒã€C++ç½‘ç»œç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µ
#### 1. **`io_context` çš„ä½œç”¨**
- **äº‹ä»¶è°ƒåº¦ä¸­å¿ƒ**ï¼šç®¡ç†å¼‚æ­¥I/Oæ“ä½œï¼ˆå¦‚Socketè¯»å†™ï¼‰ã€å®šæ—¶å™¨å’Œä¿¡å·ã€‚
- **å•çº¿ç¨‹ vs å¤šçº¿ç¨‹**ï¼šé€šå¸¸å•çº¿ç¨‹è¿è¡Œ `io_context::run()`ï¼Œä½†å¯é€šè¿‡å¤šçº¿ç¨‹æé«˜å¹¶å‘æ€§èƒ½ã€‚

#### 2. **åè®®é€‰æ‹©ï¼ˆIPv4 vs IPv6ï¼‰**
- `tcp::v4()` å’Œ `tcp::v6()` è¿”å›åè®®å¯¹è±¡ï¼Œå†³å®šSocketä½¿ç”¨çš„IPç‰ˆæœ¬ã€‚
- **åŒæ ˆæ”¯æŒ**ï¼šIPv6 Socketå¯åŒæ—¶å¤„ç†IPv4è¿æ¥ï¼ˆéœ€ç³»ç»Ÿæ”¯æŒï¼‰ã€‚

#### 3. **Socketä¸Acceptorçš„åŒºåˆ«**
| **ç‰¹æ€§**   | **Socket (tcp::socket)**         | **Acceptor (tcp::acceptor)**     |
| -------- | -------------------------------- | -------------------------------- |
| **ç”¨é€”**   | æ•°æ®ä¼ è¾“ï¼ˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼‰                    | ç›‘å¬å’Œæ¥å—æ–°è¿æ¥ï¼ˆä»…æœåŠ¡ç«¯ï¼‰                   |
| **å…³é”®æ“ä½œ** | `connect()`, `read()`, `write()` | `bind()`, `listen()`, `accept()` |
| **ç”Ÿå‘½å‘¨æœŸ** | **çŸ­ç”Ÿå‘½å‘¨æœŸï¼ˆæ¯ä¸ªè¿æ¥ä¸€ä¸ªSocketï¼‰**          | é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆæœåŠ¡è¿è¡ŒæœŸé—´æŒç»­ç›‘å¬ï¼‰                |

#### 4. **é”™è¯¯å¤„ç†æ–¹å¼**
- **å¼‚å¸¸ vs Error Code**ï¼š  
  - é»˜è®¤æŠ›å‡ºå¼‚å¸¸ï¼ˆ`boost::system::system_error`ï¼‰ï¼Œé€‚åˆå¿«é€Ÿå¤±è´¥ã€‚  
  - ä½¿ç”¨ `error_code` å‚æ•°å¯é¿å…å¼‚å¸¸ï¼Œé€‚åˆéœ€è¦ç»†ç²’åº¦æ§åˆ¶çš„åœºæ™¯ã€‚

---

### ä¸‰ã€ä»£ç æ”¹è¿›å»ºè®®
1. **å…±äº« `io_context`**  
   é¿å…æ¯æ¬¡åˆ›å»ºæ–° `io_context`ï¼Œåº”é€šè¿‡å‚æ•°ä¼ å…¥å…±äº«å®ä¾‹ï¼š
   ```cpp
   int create_tcp_socket(asio::io_context& ios) {
       asio::ip::tcp::socket sock(ios);
       // ...
   }
   ```

2. **è¡¥å…¨Acceptoræµç¨‹**  
   ç›‘å¬Socketéœ€ç»‘å®šç«¯å£å¹¶è¿›å…¥ç›‘å¬çŠ¶æ€ï¼š
   ```cpp
   // åœ¨ acceptor.open() åæ·»åŠ ï¼š
   asio::ip::tcp::endpoint endpoint(protocol, 8080);
   acceptor.bind(endpoint, ec);
   acceptor.listen(asio::socket_base::max_listen_connections, ec);
   ```

3. **èµ„æºç®¡ç†**  
   - ä½¿ç”¨RAIIç®¡ç†Socketç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ `std::unique_ptr` æˆ–å±€éƒ¨ä½œç”¨åŸŸï¼‰ã€‚

---

### å››ã€æœåŠ¡ç«¯Socketå…¸å‹æµç¨‹
1. **åˆ›å»ºAcceptor**  
   ```cpp
   asio::ip::tcp::acceptor acceptor(ios);
   acceptor.open(tcp::v4());
   acceptor.bind(tcp::endpoint(tcp::v4(), 8080));
   acceptor.listen();
   ```

2. **æ¥å—è¿æ¥**  
   ```cpp
   asio::ip::tcp::socket sock(ios);
   acceptor.accept(sock); // é˜»å¡ç›´åˆ°æœ‰æ–°è¿æ¥
   ```

3. **é€šä¿¡**  
   ```cpp
   char data[128];
   size_t len = sock.read_some(asio::buffer(data), ec);
   ```

---

### äº”ã€æ€»ç»“
- **é€šä¿¡Socket**ï¼šç”¨äºå®é™…æ•°æ®ä¼ è¾“ï¼Œéœ€é€šè¿‡ `connect()`ï¼ˆå®¢æˆ·ç«¯ï¼‰æˆ– `accept()`ï¼ˆæœåŠ¡ç«¯ï¼‰å»ºç«‹è¿æ¥ã€‚
- **ç›‘å¬Socket (Acceptor)**ï¼šæœåŠ¡ç«¯ä¸“ç”¨ï¼Œéœ€ç»‘å®šç«¯å£å¹¶ç›‘å¬ï¼Œæ¥å—æ–°è¿æ¥åç”Ÿæˆé€šä¿¡Socketã€‚
- **æ ¸å¿ƒç±»**ï¼š`io_context` é©±åŠ¨äº‹ä»¶å¾ªç¯ï¼Œ`tcp::socket` å’Œ `tcp::acceptor` åˆ†åˆ«å¤„ç†é€šä¿¡å’Œè¿æ¥ã€‚

å®é™…é¡¹ç›®ä¸­éœ€ç»“åˆå¼‚æ­¥æ“ä½œï¼ˆå¦‚ `async_accept`ã€`async_read`ï¼‰æ„å»ºé«˜æ€§èƒ½æœåŠ¡ç«¯ï¼Œå¹¶å¦¥å–„ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸã€‚












# ä¸‰ã€ç»‘å®šacceptor(æœåŠ¡å™¨)
è¿™é‡Œåªæ˜¯å¯¹æœåŠ¡å™¨ç«¯
åŒæ—¶å¯¹ä¸Šé¢çš„ä¸œè¥¿è¿›è¡Œäº†è¿ç”¨
```cpp
// å¯¹äºacceptorç±»å‹çš„socketï¼ŒæœåŠ¡å™¨è¦å°†å…¶ç»‘å®šåˆ°æŒ‡å®šçš„ç«¯ç‚¹ï¼Œä½¿å¾—æ‰€æœ‰è¿æ¥è¿™ä¸ªç«¯ç‚¹çš„è¿æ¥éƒ½èƒ½è¢«æ¥æ”¶åˆ°  
int bind_accept_socket() {  
    constexpr unsigned short port = 80;  
    // 1ã€ç«¯ç‚¹åˆ›å»º(ç”¨äºåç»­çš„acceptç«¯ç‚¹çš„ç»‘å®š)  
    asio::ip::tcp::endpoint ep(asio::ip::address_v4::any(), port);  
  
    // 2ã€åˆ›å»ºioäº‹ä»¶ç®¡ç†è€…  
    asio::io_context ioc;  
  
    // 3ã€åˆ›å»ºç›‘å¬å™¨  
    asio::ip::tcp::acceptor acceptor(ioc, ep.protocol());  
    // ep.protocol() æŒ‡æ˜IPç‰ˆæœ¬ä¸åè®®ç±»å‹  
  
    // 4ã€ç»™ç›‘å¬å™¨ç»‘å®šç«¯å£åœ°å€ä¸é”™è¯¯ç   
    system::error_code ec;  
    acceptor.bind(ep, ec);  
  
    if (ec.value() != 0) {  
        std::cout << "error happen!" << std::endl;  
        std::cout << ec.message() << std::endl;  
  
        return ec.value(); // å‡ºé”™äº†ï¼Œé€€å‡º  
    }  
  
    return 0;  
}
```
è¿™æ®µä»£ç æ˜¯ä½¿ç”¨ Boost.Asio åº“å®ç°çš„ä¸€ä¸ªç®€å•çš„ **TCP æœåŠ¡å™¨ç«¯å£ç»‘å®š** åŠŸèƒ½ã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ª TCP ç›‘å¬å¥—æ¥å­—ï¼ˆ`acceptor`ï¼‰ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ° `3333` ç«¯å£ï¼Œä½¿å…¶èƒ½å¤Ÿç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚

---

## **ä»£ç è§£æ**

### **1. æœåŠ¡å™¨ç«¯å£**

```cpp
unsigned short port_num = 3333;
```

è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª `unsigned short` å˜é‡ `port_num`ï¼Œç”¨äºæŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å· **3333**ã€‚  
åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç«¯å£å·å¯ä»¥ä»é…ç½®æ–‡ä»¶æˆ–å‘½ä»¤è¡Œå‚æ•°è·å–ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç ã€‚

---

### **2. åˆ›å»º `endpoint`**

```cpp
asio::ip::tcp::endpoint ep(asio::ip::address_v4::any(), port_num);
```

- `asio::ip::tcp::endpoint` ä»£è¡¨ä¸€ä¸ª **TCP ç«¯ç‚¹**ï¼Œå®ƒç”± IP åœ°å€å’Œç«¯å£ç»„æˆã€‚
- `asio::ip::address_v4::any()` è¡¨ç¤ºç»‘å®šåˆ° **æ‰€æœ‰å¯ç”¨çš„ IPv4 åœ°å€**ï¼ˆå³ `0.0.0.0`ï¼‰ã€‚
- `port_num` è®¾å®šç›‘å¬ç«¯å£ã€‚

è¿™ä¸ª `endpoint` ä¹‹åä¼šç”¨æ¥ç»‘å®š `acceptor`ï¼Œè®©å®ƒåœ¨ `0.0.0.0:3333` ç›‘å¬è¿æ¥ã€‚

---

### **3. åˆ›å»º `io_context`**

```cpp
asio::io_context ios;
```

- `asio::io_context` æ˜¯ **Boost.Asio çš„æ ¸å¿ƒ I/O æœåŠ¡å¯¹è±¡**ï¼Œç”¨äºç®¡ç†å¼‚æ­¥æ“ä½œã€‚
- `acceptor` éœ€è¦ `io_context` ä½œä¸ºå‚æ•°æ¥è¿›è¡Œ I/O å¤„ç†ã€‚

`ios` çš„ä½œç”¨æ˜¯ **ç®¡ç† I/O äº‹ä»¶çš„è°ƒåº¦**ï¼Œé€šå¸¸ç”¨äºï¼š

1. å¤„ç†å¼‚æ­¥ I/O äº‹ä»¶ï¼ˆå¦‚ `accept`ï¼‰ã€‚
2. é€šè¿‡ `ios.run()` è¿›å…¥äº‹ä»¶å¾ªç¯ï¼Œç­‰å¾…äº‹ä»¶å‘ç”Ÿã€‚

**æ³¨æ„ï¼š**

- è¿™é‡Œåˆ›å»ºäº† `io_context`ï¼Œä½†æ²¡æœ‰è°ƒç”¨ `ios.run()`ï¼Œæ‰€ä»¥å½“å‰ä»£ç æ˜¯ **åŒæ­¥** çš„ï¼ˆé˜»å¡æ¨¡å¼ï¼‰ã€‚
- åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåˆ›å»ºå¤šä¸ª `io_context` çº¿ç¨‹ï¼Œè®©å®ƒä»¬ **å¹¶è¡Œå¤„ç† I/O äº‹ä»¶**ã€‚

---

### **4. åˆ›å»º `acceptor`**

```cpp
asio::ip::tcp::acceptor acceptor(ios, ep.protocol());
```

- `asio::ip::tcp::acceptor` æ˜¯ **TCP è¿æ¥çš„ç›‘å¬å™¨**ï¼Œç”¨äºç­‰å¾…å’Œæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚
- `ep.protocol()` ä¼ é€’ `TCP` åè®®ç±»å‹ï¼Œè¡¨ç¤ºè¯¥ `acceptor` æ˜¯ **TCP æœåŠ¡å™¨**ã€‚

**æ³¨æ„ï¼š**

- `acceptor` åªæ˜¯**æ‰“å¼€**äº†ä¸€ä¸ªç›‘å¬å¥—æ¥å­—ï¼Œ**è¿˜æ²¡æœ‰ç»‘å®š**åˆ°å…·ä½“çš„ IP å’Œç«¯å£ã€‚
- ç»‘å®šæ“ä½œåœ¨åç»­çš„ `acceptor.bind(ep, ec)` è¿›è¡Œã€‚

---

### **5. ç»‘å®š `acceptor`**

```cpp
boost::system::error_code ec;
acceptor.bind(ep, ec);
```

- `bind()` å°† `acceptor` ç»‘å®šåˆ° `ep` æŒ‡å®šçš„åœ°å€ `0.0.0.0:3333`ã€‚
- `boost::system::error_code ec` ç”¨äºæ¥æ”¶é”™è¯¯ä¿¡æ¯ï¼Œé˜²æ­¢ `bind()` æŠ›å‡ºå¼‚å¸¸ã€‚

å¦‚æœ `bind()` å¤±è´¥ï¼Œå¯èƒ½çš„åŸå› ï¼š

- **ç«¯å£è¢«å ç”¨**ï¼šå¦‚æœå¦ä¸€ä¸ªè¿›ç¨‹å·²ç»å ç”¨äº† `3333` ç«¯å£ï¼Œç»‘å®šä¼šå¤±è´¥ã€‚
- **æƒé™ä¸è¶³**ï¼šæŸäº›ç³»ç»Ÿï¼ˆå¦‚ Linuxï¼‰ä¸å…è®¸é root ç”¨æˆ·ç»‘å®š 1024 ä»¥ä¸‹çš„ç«¯å£ã€‚
- **ç½‘ç»œé€‚é…å™¨é—®é¢˜**ï¼šä¾‹å¦‚ï¼Œç³»ç»Ÿæœªå¯ç”¨ IPv4ï¼Œæˆ–ç«¯å£å—åˆ°é˜²ç«å¢™é™åˆ¶ã€‚

---

### **6. é”™è¯¯å¤„ç†**

```cpp
if (ec.value() != 0) {
    std::cout << "Failed to bind the acceptor socket."
        << "Error code = " << ec.value() << ". Message: "
        << ec.message();
    return ec.value();
}
```

- å¦‚æœ `ec.value() != 0`ï¼Œè¯´æ˜ `bind()` å¤±è´¥ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ç ã€‚
- `ec.message()` è¿”å›å…·ä½“çš„é”™è¯¯æè¿°ã€‚

---

### **7. è¿”å›æˆåŠŸ**

```cpp
return 0;
```

å¦‚æœ `bind()` æˆåŠŸï¼Œåˆ™è¿”å› `0`ï¼Œè¡¨ç¤ºæˆåŠŸç»‘å®šã€‚

---

## **æ¶‰åŠçš„ C++ ç½‘ç»œç¼–ç¨‹çŸ¥è¯†**

### **1. Boost.Asio**

Boost.Asio æ˜¯ C++ ä¸­çš„ **è·¨å¹³å°ç½‘ç»œç¼–ç¨‹åº“**ï¼Œæä¾›äº† **åŒæ­¥** å’Œ **å¼‚æ­¥** I/O æ“ä½œï¼Œå¹¿æ³›ç”¨äºï¼š

- **ç½‘ç»œé€šä¿¡ï¼ˆTCP/UDPï¼‰**
- **å®šæ—¶å™¨**
- **ä¸²è¡Œé€šä¿¡**
- **æ–‡ä»¶ I/O**

---

### **2. `io_context`ï¼ˆäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼‰**

- `asio::io_context` æ˜¯ **I/O äº‹ä»¶ç®¡ç†å™¨**ï¼Œåœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­é€šå¸¸ç”¨äºï¼š
    
    - ç®¡ç† I/O ä»»åŠ¡
    - æ§åˆ¶ I/O çº¿ç¨‹æ± 
    - è§¦å‘å›è°ƒäº‹ä»¶
- **å¼‚æ­¥æ‰§è¡Œæ–¹å¼**
    
    - `ios.run()` å¯åŠ¨äº‹ä»¶å¾ªç¯ï¼Œç­‰å¾…äº‹ä»¶å‘ç”Ÿå¹¶è°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°ã€‚

---

### **3. `acceptor`ï¼ˆç›‘å¬å¥—æ¥å­—ï¼‰**

- æœåŠ¡å™¨é€šå¸¸éœ€è¦ **åˆ›å»ºç›‘å¬å¥—æ¥å­—** æ¥æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ã€‚
- `asio::ip::tcp::acceptor` ç”¨äºåˆ›å»ºã€ç»‘å®šå’Œç›‘å¬ TCP è¿æ¥ã€‚
- `acceptor.bind()` ç»‘å®šç«¯å£ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°æœåŠ¡å™¨ã€‚

---

### **4. ç«¯å£ç»‘å®š**

- `acceptor.bind(ep)` å°† `acceptor` ç»‘å®šåˆ°æŒ‡å®šçš„ `IP:ç«¯å£`ï¼Œä½¿å¾— `acceptor` **ç›‘å¬æŒ‡å®šç«¯å£**ã€‚
- ç«¯å£ç»‘å®šæ˜¯ **æœåŠ¡å™¨ç«¯å¿…é¡»çš„æ­¥éª¤**ï¼Œå¦åˆ™å®¢æˆ·ç«¯æ— æ³•è¿æ¥ã€‚

---

### **5. é”™è¯¯å¤„ç†ï¼ˆ`error_code` vs. å¼‚å¸¸ï¼‰**

Boost.Asio æä¾›ä¸¤ç§é”™è¯¯å¤„ç†æ–¹å¼ï¼š

1. **ä½¿ç”¨ `boost::system::error_code`**
    
    - é€‚ç”¨äº **ä¸æƒ³æŠ›å‡ºå¼‚å¸¸** çš„æƒ…å†µ
    - ä¾‹å¦‚ `acceptor.bind(ep, ec)`ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯è®¾ç½® `ec`
    - éœ€è¦æ‰‹åŠ¨æ£€æŸ¥ `ec.value()`
2. **ä½¿ç”¨å¼‚å¸¸**
    
    - é€‚ç”¨äº **æƒ³è¦æŠ›å‡ºå¼‚å¸¸** å¹¶äº¤ç»™ `try-catch` å¤„ç†çš„æƒ…å†µ
    - ä¾‹å¦‚ï¼š
        
        ```cpp
        try {
            acceptor.bind(ep);
        } catch (boost::system::system_error& e) {
            std::cout << "Exception: " << e.what() << std::endl;
        }
        ```
        

---

## **æ”¹è¿›å»ºè®®**

å½“å‰ä»£ç æ˜¯ **åŒæ­¥æ¨¡å¼**ï¼Œé€šå¸¸åœ¨å®é™…å¼€å‘ä¸­ä¼šæ”¹æˆ **å¼‚æ­¥æ¨¡å¼**ï¼š

- ä½¿ç”¨ `acceptor.async_accept()` è¿›è¡Œ **éé˜»å¡ç›‘å¬**
- è®© `io_context.run()` è¿›å…¥äº‹ä»¶å¾ªç¯
- é‡‡ç”¨ **å¤šçº¿ç¨‹** å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥

### **å¼‚æ­¥ç‰ˆæœ¬ç¤ºä¾‹**

```cpp
void handle_accept(const boost::system::error_code& ec) {
    if (!ec) {
        std::cout << "Client connected!" << std::endl;
    }
}

int main() {
    asio::io_context ios;
    asio::ip::tcp::endpoint ep(asio::ip::address_v4::any(), 3333);
    asio::ip::tcp::acceptor acceptor(ios, ep);

    acceptor.async_accept(handle_accept);  // å¼‚æ­¥æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥
    ios.run();  // å¯åŠ¨ I/O äº‹ä»¶å¾ªç¯
}
```

**ä¼˜ç‚¹** âœ… æœåŠ¡å™¨ä¸ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥  
âœ… å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ï¼ˆå¤šçº¿ç¨‹+å¼‚æ­¥å›è°ƒï¼‰  
âœ… æ›´é€‚åˆé«˜å¹¶å‘åº”ç”¨ï¼ˆå¦‚ Web æœåŠ¡å™¨ï¼‰

---

## **æ€»ç»“**

- **`io_context`** æ˜¯ I/O äº‹ä»¶ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†å¼‚æ­¥ä»»åŠ¡ã€‚
- **`tcp::acceptor`** æ˜¯ç›‘å¬å¥—æ¥å­—ï¼Œè´Ÿè´£ç­‰å¾…å’Œæ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚
- **`bind()` ç»‘å®šç«¯å£**ï¼Œä½¿æœåŠ¡å™¨èƒ½å¤Ÿç›‘å¬ç‰¹å®š `IP:ç«¯å£`ã€‚
- **`error_code` å¤„ç†é”™è¯¯**ï¼Œé¿å…å¼‚å¸¸å½±å“ç¨‹åºè¿è¡Œã€‚
- **å®é™…å¼€å‘å»ºè®®ä½¿ç”¨å¼‚æ­¥æ–¹å¼**ï¼Œæé«˜å¹¶å‘èƒ½åŠ›ã€‚

**è¿™æ®µä»£ç åªæ˜¯æœåŠ¡å™¨çš„ç¬¬ä¸€æ­¥ï¼Œè¿˜éœ€è¦ `accept()` å’Œ `socket` è¿›è¡Œå®Œæ•´é€šä¿¡ã€‚** ğŸš€














#  å››ã€è¿æ¥æŒ‡å®šçš„ç«¯ç‚¹(å®¢æˆ·ç«¯)

```cpp
// å®¢æˆ·ç«¯  
#include <string>  
#include <boost/asio.hpp>  
#include <iostream>  
using namespace boost;  
  
  
int connect_to_end() {  
    // 1ã€ç¡®å®šæœåŠ¡å™¨çš„IPä¸ç«¯å£  
    constexpr unsigned short port = 8080;  
    std::string IP_address = "127.0.0.1";  
  
    try {  
        // 2ã€æ ¹æ®1åˆ›å»ºtcpç«¯ç‚¹  
        asio::ip::tcp::endpoint ep(asio::ip::address::from_string(IP_address), port);  
  
        // 3ã€åˆå§‹åŒ–I/Oä¸Šä¸‹æ–‡ï¼ˆI/O context)  
        asio::io_context ioc;  
  
        // 4ã€å»ºç«‹socketå®ä¾‹  
        asio::ip::tcp::socket sock(ioc,ep.protocol()); // ç›´æ¥è·å–ç«¯ç‚¹çš„åè®®ä¿¡æ¯  
  
        // 5ã€è¿æ¥å°è¯•  
        system::error_code error_code;  
        sock.connect(ep, error_code);  
        if (error_code.value() != 0) {  
            std::cerr << "å‘ç”Ÿerror codeï¼" << error_code.message() << std::endl;  
            return error_code.value();  
        }  
    }catch (system::system_error& e) {  
        std::cerr << "é”™è¯¯ä»£ç :" << e.code() << std::endl;  
        std::cerr <<  "é”™è¯¯ä¿¡æ¯" << e.what() << std::endl;  
        return e.code().value();  
    }  
    return  0;  
}  
  
  
int main() {  
    connect_to_end();  
}
```



è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªä½¿ç”¨C++ ASIOåº“å®ç°TCPå®¢æˆ·ç«¯è¿æ¥çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åŒæ­¥è¿æ¥åˆ°æŒ‡å®šæœåŠ¡å™¨ã€‚ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è§£æåŠæ¶‰åŠçš„C++ç½‘ç»œç¼–ç¨‹æ¦‚å¿µï¼š

---

### **ä»£ç ç»“æ„è§£æ**
#### **1. ç›®æ ‡æœåŠ¡å™¨ä¿¡æ¯**
```cpp
std::string raw_ip_address = "127.0.0.1";  // æœåŠ¡å™¨IPï¼ˆæœ¬åœ°å›ç¯åœ°å€ï¼‰
unsigned short port_num = 3333;            // æœåŠ¡å™¨ç«¯å£
```
- **IPåœ°å€ä¸ç«¯å£**ï¼šå®¢æˆ·ç«¯éœ€è¦çŸ¥é“æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·æ‰èƒ½å»ºç«‹è¿æ¥ã€‚æ­¤å¤„ä½¿ç”¨æœ¬åœ°å›ç¯åœ°å€`127.0.0.1`å’Œç«¯å£`3333`ï¼Œé€šå¸¸ç”¨äºæœ¬åœ°æµ‹è¯•ã€‚

---

#### **2. åˆ›å»ºç«¯ç‚¹ï¼ˆEndpointï¼‰**
```cpp
asio::ip::tcp::endpoint ep(
    asio::ip::address::from_string(raw_ip_address),
    port_num
);
```
- **ç«¯ç‚¹ï¼ˆEndpointï¼‰**ï¼šè¡¨ç¤ºç½‘ç»œä¸­çš„ä¸€ä¸ªé€šä¿¡ç«¯ç‚¹ï¼ŒåŒ…å«IPåœ°å€å’Œç«¯å£å·ã€‚
- **åœ°å€è§£æ**ï¼š`asio::ip::address::from_string`å°†å­—ç¬¦ä¸²æ ¼å¼çš„IPåœ°å€è½¬æ¢ä¸ºASIOçš„åœ°å€å¯¹è±¡ã€‚å¦‚æœIPæ ¼å¼éæ³•ï¼ˆå¦‚`256.0.0.1`ï¼‰ï¼Œæ­¤å‡½æ•°ä¼šæŠ›å‡º`system_error`å¼‚å¸¸ã€‚

---

#### **3. åˆå§‹åŒ–I/Oä¸Šä¸‹æ–‡ï¼ˆI/O Contextï¼‰**
```cpp
asio::io_context ios;
```
- **I/Oä¸Šä¸‹æ–‡**ï¼šASIOåº“çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†I/Oæ“ä½œå’Œå¼‚æ­¥äº‹ä»¶è°ƒåº¦ã€‚åœ¨åŒæ­¥ç¼–ç¨‹ä¸­ï¼Œå®ƒä¸»è¦ç”¨äºç»‘å®šèµ„æºï¼ˆå¦‚å¥—æ¥å­—ï¼‰ï¼Œä½†æ— éœ€æ˜¾å¼è°ƒç”¨`run()`æ–¹æ³•ã€‚

---

#### **4. åˆ›å»ºå¹¶æ‰“å¼€å¥—æ¥å­—ï¼ˆSocketï¼‰**
```cpp
asio::ip::tcp::socket sock(ios, ep.protocol());
```
- **å¥—æ¥å­—ï¼ˆSocketï¼‰**ï¼šè¡¨ç¤ºä¸€ä¸ªç½‘ç»œé€šä¿¡çš„ç«¯ç‚¹ï¼Œç”¨äºå‘é€å’Œæ¥æ”¶æ•°æ®ã€‚
- **åè®®æŒ‡å®š**ï¼š`ep.protocol()`è¿”å›ç«¯ç‚¹ä½¿ç”¨çš„åè®®ï¼ˆå¦‚TCP IPv4æˆ–IPv6ï¼‰ã€‚å¥—æ¥å­—æ„é€ å‡½æ•°ä¼šæ ¹æ®åè®®è‡ªåŠ¨è°ƒç”¨`open()`æ–¹æ³•æ‰“å¼€å¥—æ¥å­—ã€‚è‹¥åè®®ä¸æ”¯æŒï¼ˆå¦‚å°è¯•æ‰“å¼€UDPå¥—æ¥å­—æ—¶æŒ‡å®šTCPåè®®ï¼‰ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

---

#### **5. å»ºç«‹è¿æ¥**
```cpp
sock.connect(ep);
```
- **åŒæ­¥è¿æ¥**ï¼š`connect()`æ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¿æ¥æˆåŠŸæˆ–å¤±è´¥ã€‚å¯èƒ½çš„é”™è¯¯åŒ…æ‹¬ï¼š
  - æœåŠ¡å™¨æœªè¿è¡Œï¼ˆ`ECONNREFUSED`ï¼‰ã€‚
  - ç½‘ç»œä¸å¯è¾¾ï¼ˆ`ENETUNREACH`ï¼‰ã€‚
  - è¶…æ—¶ï¼ˆ`ETIMEDOUT`ï¼‰ã€‚
- **å¼‚å¸¸å¤„ç†**ï¼šè‹¥è¿æ¥å¤±è´¥ï¼ŒASIOä¼šæŠ›å‡º`system_error`å¼‚å¸¸ã€‚

---

#### **6. å¼‚å¸¸å¤„ç†**
```cpp
catch (system::system_error& e) {
    std::cout << "Error occurred! Error code = " << e.code()
              << ". Message: " << e.what();
    return e.code().value();
}
```
- **é”™è¯¯æ•è·**ï¼šASIOé€šè¿‡æŠ›å‡º`system_error`å¼‚å¸¸æŠ¥å‘Šé”™è¯¯ï¼Œå¼‚å¸¸å¯¹è±¡åŒ…å«é”™è¯¯ç ï¼ˆ`error_code`ï¼‰å’Œæè¿°ä¿¡æ¯ï¼ˆ`what()`ï¼‰ã€‚
- **é”™è¯¯ç ç±»å‹**ï¼šé”™è¯¯ç å¯èƒ½æ˜¯æ“ä½œç³»ç»ŸåŸç”Ÿé”™è¯¯ï¼ˆå¦‚`errno`ï¼‰æˆ–ASIOè‡ªå®šä¹‰é”™è¯¯ã€‚

---

### **æ¶‰åŠçš„C++ç½‘ç»œç¼–ç¨‹æ¦‚å¿µ**
#### **1. åŒæ­¥ä¸å¼‚æ­¥æ“ä½œ**
- **åŒæ­¥æ“ä½œ**ï¼šä»£ç ä¸­ä½¿ç”¨çš„æ˜¯åŒæ­¥è¿æ¥æ–¹å¼ï¼ˆ`sock.connect(ep)`ï¼‰ï¼Œçº¿ç¨‹ä¼šé˜»å¡ç›´åˆ°æ“ä½œå®Œæˆã€‚é€‚åˆç®€å•åœºæ™¯ï¼Œä½†å¯èƒ½å½±å“ç¨‹åºå“åº”æ€§ã€‚
- **å¼‚æ­¥æ“ä½œ**ï¼šASIOæ›´å¼ºå¤§çš„åŠŸèƒ½åœ¨äºå¼‚æ­¥æ¨¡å¼ï¼ˆå¦‚`async_connect`ï¼‰ï¼Œéœ€ç»“åˆ`io_context::run()`å’Œå›è°ƒå‡½æ•°ï¼Œé€‚åˆé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„éœ€æ±‚ã€‚

---

#### **2. ç«¯ç‚¹ï¼ˆEndpointï¼‰ä¸åè®®**
- **ç«¯ç‚¹**ï¼š`asio::ip::tcp::endpoint`å°è£…äº†IPåœ°å€å’Œç«¯å£ï¼Œæ˜¯ç½‘ç»œé€šä¿¡çš„ç›®æ ‡ã€‚
- **åè®®**ï¼šé€šè¿‡`endpoint::protocol()`å¯è·å–åè®®ç±»å‹ï¼ˆå¦‚TCP IPv4ï¼‰ï¼Œç¡®ä¿å¥—æ¥å­—ä¸ç«¯ç‚¹åè®®ä¸€è‡´ã€‚

---

#### **3. å¥—æ¥å­—ç”Ÿå‘½å‘¨æœŸç®¡ç†**
- **æ„é€ ä¸æ‰“å¼€**ï¼šå¥—æ¥å­—åœ¨æ„é€ æ—¶é€šè¿‡`ep.protocol()`æŒ‡å®šåè®®å¹¶è‡ªåŠ¨æ‰“å¼€ã€‚
- **èµ„æºé‡Šæ”¾**ï¼šå¥—æ¥å­—ææ„æ—¶ä¼šè‡ªåŠ¨å…³é—­è¿æ¥ï¼Œä¹Ÿå¯æ‰‹åŠ¨è°ƒç”¨`close()`ã€‚

---

#### **4. é”™è¯¯å¤„ç†æœºåˆ¶**
- **å¼‚å¸¸ vs é”™è¯¯ç **ï¼šASIOæä¾›ä¸¤ç§é”™è¯¯å¤„ç†æ–¹å¼ï¼š
  1. **å¼‚å¸¸**ï¼ˆå¦‚æœ¬ä¾‹ï¼‰ï¼šä»£ç ç®€æ´ï¼Œé€‚åˆé›†ä¸­å¤„ç†é”™è¯¯ã€‚
  2. **é”™è¯¯ç å‚æ•°**ï¼šé€šè¿‡å‡½æ•°å‚æ•°è¿”å›é”™è¯¯ï¼Œéœ€æ˜¾å¼æ£€æŸ¥ã€‚
- **é”™è¯¯ç ç±»å‹**ï¼š`error_code`åŒ…å«ç±»åˆ«ï¼ˆ`category()`ï¼‰å’Œå…·ä½“å€¼ï¼ˆ`value()`ï¼‰ï¼Œå¯åŒºåˆ†ç³»ç»Ÿé”™è¯¯å’ŒASIOå†…éƒ¨é”™è¯¯ã€‚

---

### **æ½œåœ¨æ”¹è¿›ç‚¹**
1. **å¼‚æ­¥è¿æ¥**ï¼šä½¿ç”¨`async_connect`é…åˆ`io_context::run()`å®ç°éé˜»å¡æ“ä½œã€‚
2. **IPv6æ”¯æŒ**ï¼šæ£€æŸ¥IPåœ°å€æ ¼å¼ï¼Œå…¼å®¹IPv6ï¼ˆå¦‚`asio::ip::tcp::v6()`ï¼‰ã€‚
3. **è¶…æ—¶è®¾ç½®**ï¼šåŒæ­¥æ“ä½œå¯èƒ½æ— é™é˜»å¡ï¼Œå¯é€šè¿‡`asio::deadline_timer`å®ç°è¶…æ—¶æ§åˆ¶ã€‚
4. **é‡ç”¨åœ°å€/ç«¯å£**ï¼šè®¾ç½®å¥—æ¥å­—é€‰é¡¹ï¼ˆ`SO_REUSEADDR`ç­‰ï¼‰æå‡çµæ´»æ€§ã€‚

---

### **æ€»ç»“**
è¿™æ®µä»£ç å±•ç¤ºäº†C++ä¸­ä½¿ç”¨ASIOåº“è¿›è¡ŒåŒæ­¥TCPå®¢æˆ·ç«¯è¿æ¥çš„åŸºæœ¬æµç¨‹ï¼Œæ¶µç›–äº†ç«¯ç‚¹åˆ›å»ºã€å¥—æ¥å­—ç®¡ç†ã€åŒæ­¥è¿æ¥åŠå¼‚å¸¸å¤„ç†ç­‰å…³é”®æ­¥éª¤ã€‚ç†è§£è¿™äº›æ¦‚å¿µåï¼Œå¯è¿›ä¸€æ­¥æ¢ç´¢å¼‚æ­¥ç¼–ç¨‹ã€åè®®æ— å…³è®¾è®¡ï¼ˆå¦‚é€šè¿‡åŸŸåè§£æè·å–IPï¼‰å’Œé«˜çº§ç‰¹æ€§ï¼ˆå¦‚SSL/TLSæ”¯æŒï¼‰ã€‚











#  äº”ã€æ¥æ”¶è¿æ¥ï¼ˆæœåŠ¡å™¨ï¼‰
```cpp
// æœåŠ¡å™¨ç«¯  
#include <boost/asio.hpp>  
#include <string>  
#include <iostream>  
using namespace boost;  
  
  
int accept_new_connection() {  
    // 1ã€è®¾å®šç›‘å¬é˜Ÿåˆ—çš„å¤§å°  
    const unsigned int batch_size = 30;  
  
    // 2ã€è®¾ç½®ç«¯å£  
    const unsigned short port = 80;  
  
    // 3ã€è®¾ç½®ç«¯ç‚¹  
    asio::ip::tcp::endpoint ep(asio::ip::address_v4::any(), port);  
  
    // 4ã€è®¾ç½®io  
    asio::io_context ioc;  
  
    // 5ã€ç›‘å¬å™¨åˆ›å»ºï¼Œä¸æŒ‡å®šç«¯ç‚¹  
    asio::ip::tcp::acceptor ace(ioc, ep.protocol());  
  
    // 6ã€ç»‘å®šç«¯ç‚¹  
    system::error_code ec_bind;  
    ace.bind(ep, ec_bind);  
    if (ec_bind.value() != 0) {  
        std::cerr << ec_bind.message() << std::endl;  
        std::cerr << "ec_bindæŠ¥é”™" << std::endl;  
    }  
  
    // 7ã€ç›‘å¬  
    system::error_code ec_listen;  
    ace.listen(batch_size, ec_listen);  
    if (ec_listen.value() != 0) {  
        std::cerr << ec_listen.message() << std::endl;  
        std::cerr << "ec_listenæŠ¥é”™" << std::endl;  
    }  
  
    // 8ã€é€šä¿¡ç‚¹  
    asio::ip::tcp::socket sock(ioc);  
    ace.accept(sock);  
    std::cout << "æˆåŠŸ" << std::endl;  
    return  0;  
}  
  
int main() {  
    accept_new_connection();  
}
```
è¿™æ®µä»£ç æ˜¯ä½¿ç”¨ **Boost.Asio** è¿›è¡Œ **TCP æœåŠ¡å™¨ç«¯è¿æ¥æ¥å—** çš„ç¤ºä¾‹ã€‚å®ƒæ¼”ç¤ºäº†å¦‚ä½•åœ¨ C++ ä¸­é€šè¿‡ Boost.Asio è¿›è¡Œ**åŒæ­¥ï¼ˆblockingï¼‰ç½‘ç»œç¼–ç¨‹**ï¼Œå³å¦‚ä½•ç›‘å¬ç«¯å£ã€æ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶ä¸ºæ–°è¿æ¥åˆ›å»º socketã€‚

---

## **ä»£ç è§£æ**

```cpp
int accept_new_connection() {
```

å®šä¹‰ä¸€ä¸ª `accept_new_connection()` å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š

- ç›‘å¬æŒ‡å®šç«¯å£ `3333`ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥
- æ¥å—è¿æ¥ï¼Œå¹¶å»ºç«‹é€šä¿¡
- å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ç 

### **1. è®¾å®šç›‘å¬é˜Ÿåˆ—çš„å¤§å°**

```cpp
const int BACKLOG_SIZE = 30;
```

- `BACKLOG_SIZE`ï¼šæŒ‡å®šè¿æ¥é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ï¼ˆæœ€å¤šå…è®¸ 30 ä¸ªè¿æ¥ç­‰å¾…è¢«æ¥å—ï¼‰ã€‚
- è¿™æ˜¯ `listen()` å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨äºæ§åˆ¶**æ“ä½œç³»ç»Ÿå…è®¸çš„æœ€å¤§ç­‰å¾…è¿æ¥æ•°**ã€‚

---

### **2. æœåŠ¡å™¨ç«¯å£å·**

```cpp
unsigned short port_num = 3333;
```

- æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·è®¾ä¸º `3333`ï¼Œå®¢æˆ·ç«¯éœ€è¦è¿æ¥è¯¥ç«¯å£æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚

---

### **3. åˆ›å»ºæœåŠ¡å™¨ç«¯ç‚¹ (endpoint)**

```cpp
asio::ip::tcp::endpoint ep(asio::ip::address_v4::any(), port_num);
```

- `asio::ip::tcp::endpoint` è¡¨ç¤ºä¸€ä¸ª TCP ç«¯ç‚¹ï¼ŒåŒ…å« **IP åœ°å€** å’Œ **ç«¯å£å·**ã€‚
- `asio::ip::address_v4::any()` è¡¨ç¤ºç›‘å¬æ‰€æœ‰ç½‘å¡ä¸Šçš„è¯·æ±‚ï¼ˆ0.0.0.0ï¼‰ã€‚
- `port_num` è®¾å®šç«¯å£ã€‚

---

### **4. åˆ›å»º I/O ä¸Šä¸‹æ–‡**

```cpp
asio::io_context ios;
```

- `io_context` æ˜¯ **Boost.Asio** ä¸­çš„ I/O æœåŠ¡ç®¡ç†å™¨ï¼Œæ‰€æœ‰ I/O æ“ä½œéƒ½éœ€è¦å®ƒæ¥æä¾›å¼‚æ­¥æˆ–åŒæ­¥æ”¯æŒã€‚
- åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨åŒæ­¥æ¨¡å¼ã€‚

---

### **5. åˆ›å»ºå¹¶æ‰“å¼€ acceptor**

```cpp
asio::ip::tcp::acceptor acceptor(ios, ep.protocol());
```

- `acceptor` æ˜¯ **TCP æœåŠ¡å™¨ç«¯** çš„ socketï¼Œä¸“é—¨ç”¨äºç›‘å¬å¹¶æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚
- è¿™é‡Œçš„ `ep.protocol()` ä¼ å…¥çš„æ˜¯ `tcp::v4()`ï¼Œè¡¨ç¤º IPv4ã€‚

---

### **6. ç»‘å®šç«¯ç‚¹**

```cpp
acceptor.bind(ep);
```

- ç»‘å®š acceptor åˆ° `ep`ï¼ˆå³ç«¯å£ 3333ï¼‰ã€‚
- è¿™ä¸€æ­¥é€šå¸¸å¯èƒ½ä¼šé‡åˆ° **ç«¯å£å ç”¨** é—®é¢˜ï¼Œå¯ä»¥ï¼š
    - **æå‰æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨**
    - **ä½¿ç”¨ SO_REUSEADDR é€‰é¡¹å…è®¸ç«¯å£å¤ç”¨**

---

### **7. å¼€å§‹ç›‘å¬**

```cpp
acceptor.listen(BACKLOG_SIZE);
```

- è®© `acceptor` è¿›å…¥ **ç›‘å¬æ¨¡å¼**ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ã€‚
- `BACKLOG_SIZE` æ§åˆ¶ç³»ç»Ÿå…è®¸çš„æœ€å¤§æœªå¤„ç†è¿æ¥æ•°ï¼ˆè¿™é‡Œè®¾ä¸º 30ï¼‰ã€‚
- åœ¨ Linux ä¸‹ï¼Œå¯èƒ½éœ€è¦ `sysctl` è°ƒæ•´ `net.core.somaxconn` æ‰èƒ½çœŸæ­£å¢å¤§ backlogã€‚

> åœ¨ Boost.Asio ä¸­ï¼Œ`tcp::acceptor`Â çš„Â **`accept()`Â æ“ä½œä¼šè‡ªåŠ¨è§¦å‘éšå¼ç›‘å¬**ï¼Œè¿™æ˜¯è¯¥åº“è®¾è®¡çš„ä¾¿æ·ç‰¹æ€§ã€‚

---

### **8. åˆ›å»ºç”¨äºé€šä¿¡çš„ socket**

```cpp
asio::ip::tcp::socket sock(ios);
```

- `sock` æ˜¯**ç”¨äºå®é™…é€šä¿¡çš„ socket**ã€‚
- `acceptor` **åªç”¨äºç›‘å¬**ï¼Œè€Œ `sock` ç”¨äº**å®é™…çš„æ”¶å‘æ•°æ®**ã€‚

---

### **9. æ¥å—æ–°è¿æ¥**

```cpp
acceptor.accept(sock);
```

- `acceptor.accept(sock)` **é˜»å¡**ï¼Œç›´åˆ°æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œéšåï¼š
    - æœåŠ¡å™¨ `acceptor` æ¥å—è¯¥è¿æ¥
    - `sock` å˜ä¸º **å·²è¿æ¥çŠ¶æ€**ï¼Œå¯ç”¨äºæ•°æ®æ”¶å‘

**æ³¨æ„**ï¼šè¿™æ˜¯**åŒæ­¥é˜»å¡**çš„ `accept()` è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…ã€‚

---

### **10. å¤„ç†å¼‚å¸¸**

```cpp
catch (system::system_error& e) {
    std::cout << "Error occured! Error code = " << e.code()
              << ". Message: " << e.what();
    return e.code().value();
}
```

- `system_error` æ˜¯ Boost.Asio å¤„ç†ç³»ç»Ÿé”™è¯¯çš„æ–¹å¼ã€‚
- å¦‚æœ `bind()`ã€`listen()` æˆ– `accept()` å¤±è´¥ï¼Œä¼šæŠ›å‡º `system_error`ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ç ã€‚

---

## **æ¶‰åŠçš„ C++ ç½‘ç»œç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µ**

### **1. Boost.Asio**

Boost.Asio æ˜¯ C++ ä¸­æœ€å¸¸ç”¨çš„**è·¨å¹³å°ç½‘ç»œåº“**ï¼Œæä¾›ï¼š

- **åŒæ­¥/å¼‚æ­¥** I/O æ“ä½œ
- **TCP/UDP/Unix åŸŸ socket**
- **å®šæ—¶å™¨**
- **çº¿ç¨‹æ± **

æœ¬ä»£ç é‡‡ç”¨ **åŒæ­¥æ–¹å¼**ï¼Œå³ `acceptor.accept(sock);` ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰å®¢æˆ·ç«¯è¿æ¥ã€‚

---

### **2. TCP Server è¿è¡Œæµç¨‹**

**(1) åˆ›å»º acceptor**

- `acceptor` è´Ÿè´£ç›‘å¬ç«¯å£ï¼Œç­‰å¾…è¿æ¥è¯·æ±‚ã€‚

**(2) ç»‘å®šç«¯å£**

- ä½¿ç”¨ `bind()` ç»‘å®šåˆ°ç‰¹å®šç«¯å£å’Œ IP åœ°å€ã€‚

**(3) ç›‘å¬å®¢æˆ·ç«¯è¿æ¥**

- `listen()` è®© `acceptor` è¿›å…¥ç›‘å¬çŠ¶æ€ï¼Œå‡†å¤‡æ¥å—å®¢æˆ·ç«¯è¿æ¥ã€‚

**(4) é˜»å¡ç­‰å¾…è¿æ¥**

- `acceptor.accept(sock);` **é˜»å¡**ï¼Œç›´åˆ°æœ‰å®¢æˆ·ç«¯è¿æ¥ã€‚

**(5) å¤„ç†è¿æ¥**

- `sock` ç°åœ¨å¯ç”¨äº `send()` æˆ– `receive()`ã€‚

---

### **3. TCP ä¸‰æ¬¡æ¡æ‰‹**

å½“ `accept()` æˆåŠŸæ—¶ï¼Œæ„å‘³ç€**å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å·²å®Œæˆ TCP ä¸‰æ¬¡æ¡æ‰‹**ï¼š

1. **å®¢æˆ·ç«¯ -> æœåŠ¡å™¨**ï¼šå‘é€ `SYN`
2. **æœåŠ¡å™¨ -> å®¢æˆ·ç«¯**ï¼šå‘é€ `SYN-ACK`
3. **å®¢æˆ·ç«¯ -> æœåŠ¡å™¨**ï¼šå‘é€ `ACK`ï¼Œè¿æ¥å»ºç«‹

ç„¶åï¼Œ`sock` å°±å¯ä»¥**è¿›è¡Œæ•°æ®æ”¶å‘**ã€‚

---

## **ä»£ç ä¼˜åŒ–å»ºè®®**

### **1. ä½¿ç”¨ `system::error_code` ä»£æ›¿ `try-catch`**

```cpp
system::error_code ec;
acceptor.bind(ep, ec);
if (ec) {
    std::cerr << "Bind failed: " << ec.message() << std::endl;
    return ec.value();
}
```

è¿™æ ·å¯ä»¥é¿å… `try-catch` å¤„ç†å¼‚å¸¸ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚

---

### **2. è®© `accept()` éé˜»å¡**

ç›®å‰ `accept()` **ä¼šé˜»å¡**ï¼Œå¯ä»¥æ”¹æˆ **å¼‚æ­¥æ–¹å¼**ï¼š

```cpp
acceptor.async_accept(sock, [](const system::error_code& ec) {
    if (!ec) {
        std::cout << "New connection accepted" << std::endl;
    }
});
ios.run();
```

è¿™æ · `accept()` **ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹**ï¼Œå¯åŒæ—¶å¤„ç†å¤šä¸ªè¿æ¥ã€‚

---

### **3. å¤„ç†å¤šä¸ªè¿æ¥**

å½“å‰ä»£ç  **åªèƒ½å¤„ç†ä¸€ä¸ªè¿æ¥**ï¼Œä½†æœåŠ¡å™¨åº”è¯¥**èƒ½æ¥å—å¤šä¸ªè¿æ¥**ï¼š

```cpp
void start_accept(asio::ip::tcp::acceptor& acceptor) {
    auto sock = std::make_shared<asio::ip::tcp::socket>(acceptor.get_executor().context());
    acceptor.async_accept(*sock, [sock, &acceptor](const system::error_code& ec) {
        if (!ec) {
            std::cout << "New client connected!" << std::endl;
        }
        start_accept(acceptor); // ç»§ç»­ç›‘å¬æ–°çš„è¿æ¥
    });
}
```

**é€’å½’è°ƒç”¨ `start_accept()`ï¼Œå®ç°å¤šä¸ªå®¢æˆ·ç«¯å¹¶å‘è¿æ¥ã€‚**

---

## **æ€»ç»“**

- è¯¥ä»£ç æ˜¯ä¸€ä¸ª**åŒæ­¥é˜»å¡**çš„ TCP æœåŠ¡å™¨ï¼Œç›‘å¬ `3333` ç«¯å£ã€‚
- `asio::io_context` ç®¡ç† I/O æ“ä½œï¼Œ`acceptor` ç›‘å¬ç«¯å£ï¼Œ`sock` å¤„ç†è¿æ¥ã€‚
- `accept()` æ˜¯é˜»å¡çš„ï¼Œæ„å‘³ç€**åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯**ã€‚
- å¯ä»¥ä¼˜åŒ–ä¸º **å¼‚æ­¥ accept**ï¼Œæé«˜**å¹¶å‘èƒ½åŠ›**ã€‚

å¦‚æœæƒ³åš **é«˜æ€§èƒ½æœåŠ¡å™¨**ï¼Œå¯ä»¥ï¼š

- ç”¨ **å¼‚æ­¥ accept**
- ç”¨ **çº¿ç¨‹æ± **
- ç”¨ **åç¨‹ï¼ˆBoost.Coroutineï¼‰**

ä½ å¯ä»¥å°è¯•æ”¹è¿›ä»£ç ï¼Œè®©å®ƒæ”¯æŒ**å¤šå®¢æˆ·ç«¯å¹¶å‘**ï¼ğŸš€



# å…³äºbuffer
è¿™æ®µå†…å®¹ä¸»è¦è®²è§£äº† **Boost Asio** ä¸­çš„ç¼“å†²åŒºç®¡ç†ä»¥åŠå¦‚ä½•é€šè¿‡ `buffer()` å‡½æ•°ç®€åŒ–æ•°æ®æ“ä½œï¼Œå…·ä½“åŒ…æ‹¬ `mutable_buffer`ã€`const_buffer`ã€`MutableBufferSequence`ã€`ConstBufferSequence`ï¼Œä»¥åŠå¦‚ä½•ä¸ `asio::streambuf` é…åˆè¿›è¡Œæµå¼æ“ä½œã€‚è®©æˆ‘ä»¬é€æ­¥è¯¦ç»†åˆ†ææ¯ä¸€éƒ¨åˆ†ï¼Œå¹¶å¯¹ç›¸å…³çŸ¥è¯†è¿›è¡Œæ‹“å±•è®²è§£ã€‚

 ### 1. **ç¼“å†²åŒºï¼ˆBufferï¼‰çš„åŸºæœ¬æ¦‚å¿µ**

**ç¼“å†²åŒºï¼ˆBufferï¼‰** ä¸»è¦æ˜¯ç”¨äºåœ¨æ•°æ®çš„å‘é€å’Œæ¥æ”¶è¿‡ç¨‹ä¸­å­˜å‚¨æ•°æ®ã€‚å®ƒæ˜¯ä¸€å—å†…å­˜åŒºåŸŸï¼Œä¸»è¦ç”¨äºæš‚æ—¶ä¿å­˜æ•°æ®ï¼Œé¿å…ç›´æ¥è¯»å†™æ“ä½œå¯¼è‡´æ•ˆç‡ä½ä¸‹æˆ–é˜»å¡ã€‚æ¯å½“æˆ‘ä»¬å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œæ•°æ®çš„ä¼ è¾“å¾€å¾€ä¸æ˜¯åŒæ­¥çš„ï¼Œæ•°æ®éœ€è¦è¢«ç¼“å­˜åˆ°ç¼“å†²åŒºä¸­æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚

åœ¨ **Boost Asio** ä¸­ï¼Œç¼“å†²åŒºçš„æ•°æ®ç»“æ„æ˜¯ `mutable_buffer` å’Œ `const_buffer`ã€‚

- **`mutable_buffer`**ï¼šç”¨äºå¯å†™æ“ä½œï¼Œå…è®¸å‘ç¼“å†²åŒºä¸­å†™å…¥æ•°æ®ã€‚
- **`const_buffer`**ï¼šç”¨äºåªè¯»æ“ä½œï¼Œå…è®¸ä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ã€‚

### 2. **`mutable_buffer` å’Œ `const_buffer` çš„è¯¦ç»†ä»‹ç»**

è¿™ä¸¤ä¸ªç±»åˆ†åˆ«ä»£è¡¨äº†ä¸€ä¸ªå†…å­˜åŒºåŸŸçš„ä¸å¯å˜æˆ–å¯å˜ç¼“å†²åŒºã€‚å®ƒä»¬çš„ç»“æ„å¾ˆç®€å•ï¼Œä¸€èˆ¬åŒ…æ‹¬ï¼š

- **æŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆ**
- **ç¼“å†²åŒºçš„å¤§å°**

```cpp
asio::mutable_buffer mutable_buf(ptr, size);  // ç”¨äºå†™æ“ä½œ
asio::const_buffer const_buf(ptr, size);  // ç”¨äºè¯»æ“ä½œ
```

è¿™ä¸¤ä¸ªç±»å­˜å‚¨çš„æ˜¯è¿ç»­å†…å­˜åŒºåŸŸï¼Œå› æ­¤å®ƒä»¬å¯ä»¥é«˜æ•ˆåœ°è¿›è¡Œå†…å­˜ç®¡ç†ã€‚

### 3. **`MutableBufferSequence` å’Œ `ConstBufferSequence`**

è¿™ä¸¤ä¸ªæ¦‚å¿µå®é™…ä¸Šæ˜¯å®¹å™¨ç±»å‹ï¼Œåˆ†åˆ«åŒ…å«å¤šä¸ª `mutable_buffer` æˆ– `const_buffer`ã€‚å®ƒä»¬çš„ç›®çš„æ˜¯åœ¨ Boost Asio ä¸­è¿›è¡Œé«˜æ•ˆçš„ I/O æ“ä½œæ—¶ï¼Œæ”¯æŒå¤šä¸ªç¼“å†²åŒºçš„ç»„åˆã€‚

- **`MutableBufferSequence`**ï¼šç”±å¤šä¸ª `mutable_buffer` ç»„æˆï¼Œé€šå¸¸ç”¨äºå†™æ“ä½œã€‚
- **`ConstBufferSequence`**ï¼šç”±å¤šä¸ª `const_buffer` ç»„æˆï¼Œé€šå¸¸ç”¨äºè¯»æ“ä½œã€‚

å½“ä½ å‘ Boost Asio çš„ API ä¼ é€’ç¼“å†²åŒºæ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨è¿™äº›åºåˆ—ç±»å‹æ¥ä¼ é€’æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯å•ä¸ªç¼“å†²åŒºã€‚è¿™ç§è®¾è®¡çš„ä¸€ä¸ªå¥½å¤„æ˜¯ä½ å¯ä»¥ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªç¼“å†²åŒºçš„è¯»å†™æ“ä½œã€‚

### 4. **`buffer()` å‡½æ•°çš„ä½œç”¨ä¸ä½¿ç”¨**

Boost Asio æä¾›äº† `buffer()` å‡½æ•°ï¼Œç®€åŒ–äº† `MutableBufferSequence` å’Œ `ConstBufferSequence` çš„åˆ›å»ºè¿‡ç¨‹ã€‚ä½ ä¸å†éœ€è¦æ‰‹åŠ¨æ„é€  `std::vector<asio::mutable_buffer>` æˆ– `std::vector<asio::const_buffer>`ï¼Œè€Œæ˜¯å¯ä»¥é€šè¿‡ `buffer()` æ¥åˆ›å»ºé€‚å½“çš„ç¼“å†²åŒºåºåˆ—ã€‚

```cpp
asio::const_buffers_1 output_buf = asio::buffer("hello world");
```

`buffer()` çš„ä½œç”¨æ˜¯è‡ªåŠ¨è¯†åˆ«ä¼ å…¥æ•°æ®çš„ç±»å‹ï¼š

- å¦‚æœä¼ å…¥çš„æ˜¯åªè¯»æ•°æ®ç±»å‹ï¼ˆå¦‚ `const char*`ï¼‰ï¼Œåˆ™è¿”å› `const_buffers_1` ç±»å‹ã€‚
- å¦‚æœä¼ å…¥çš„æ˜¯å¯å†™æ•°æ®ç±»å‹ï¼ˆå¦‚ `std::vector<char>` æˆ– `std::unique_ptr<char[]>`ï¼‰ï¼Œåˆ™è¿”å› `mutable_buffers_1` ç±»å‹ã€‚

è¿™æ ·ï¼Œ`buffer()` å‡½æ•°å°±å……å½“äº†ä¸€ä¸ªé€‚é…å™¨ï¼Œè‡ªåŠ¨å°†ä¸åŒç±»å‹çš„æ•°æ®è½¬æ¢ä¸ºé€‚åˆ Boost Asio API ä½¿ç”¨çš„ç¼“å†²åŒºç±»å‹ã€‚

### 5. **å®é™…ä½¿ç”¨ç¤ºä¾‹**

#### 5.1 å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯å‘é€æ•°æ®ç±»å‹

åœ¨ Boost Asio ä¸­ï¼Œå‘é€æ•°æ®é€šå¸¸éœ€è¦ä¸€ä¸ªç¼“å†²åŒºåºåˆ—ã€‚ä½ å¯ä»¥ä½¿ç”¨ `buffer()` å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºé€‚åˆå‘é€çš„ç¼“å†²åŒºç±»å‹ï¼š

```cpp
void use_buffer_str() {
    asio::const_buffers_1 output_buf = asio::buffer("hello world");
    // output_buf å¯ä»¥ç›´æ¥ä¼ é€’ç»™ send æ¥å£
}
```

`output_buf` æ˜¯ä¸€ä¸ªç¬¦åˆ `ConstBufferSequence` æ¦‚å¿µçš„ç¼“å†²åŒºå¯¹è±¡ï¼Œå®ƒå¯ä»¥ç›´æ¥ä¼ é€’ç»™å‘é€æ¥å£ã€‚

#### 5.2 å°†æ•°ç»„è½¬æ¢ä¸ºç¼“å†²åŒºç±»å‹

å¯¹äºå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `buffer()` å‡½æ•°å°†å…¶è½¬æ¢ä¸ºé€‚åˆ Boost Asio çš„ç¼“å†²åŒºï¼š

```cpp
void use_buffer_array(){
    const size_t BUF_SIZE_BYTES = 20;
    std::unique_ptr<char[]> buf(new char[BUF_SIZE_BYTES]);
    auto input_buf = asio::buffer(static_cast<void*>(buf.get()), BUF_SIZE_BYTES);
}
```

è¿™ç§æ–¹å¼å¸¸ç”¨äºéœ€è¦ä»è£¸æŒ‡é’ˆæˆ–åŠ¨æ€åˆ†é…å†…å­˜ä¸­åˆ›å»ºç¼“å†²åŒºçš„åœºæ™¯ã€‚

### 6. **`streambuf` å’Œæµå¼æ“ä½œ**

**`asio::streambuf`** æ˜¯ Boost Asio æä¾›çš„æµå¼æ•°æ®ç¼“å†²åŒºï¼Œå®ƒä½¿å¾—é€šè¿‡æµçš„æ–¹å¼æ¥å¤„ç†æ•°æ®å˜å¾—æ›´ç®€å•ã€‚æµå¼æ“ä½œæ„å‘³ç€æ•°æ®å¯ä»¥åƒå¤„ç†æ–‡æœ¬æµé‚£æ ·è¢«é€æ­¥è¯»å–æˆ–å†™å…¥ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ•´ä¸ªæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚

- **`streambuf`**ï¼šæä¾›äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œå…è®¸å°†æ•°æ®æŒ‰æµçš„æ–¹å¼è¯»å†™ã€‚
- **`std::ostream` å’Œ `std::istream`**ï¼šå¯ä»¥ä¸ `streambuf` ç»“åˆä½¿ç”¨ï¼Œåˆ†åˆ«è¿›è¡Œæ•°æ®çš„å†™å…¥å’Œè¯»å–ã€‚

#### 6.1 å†™å…¥æ•°æ®åˆ° `streambuf`

```cpp
asio::streambuf buf;
std::ostream output(&buf);
output << "Message1\nMessage2";  // å‘ streambuf å†™æ•°æ®
```

#### 6.2 ä» `streambuf` è¯»å–æ•°æ®

```cpp
std::istream input(&buf);
std::string message1;
std::getline(input, message1);  // ä» streambuf è¯»å–æ•°æ®ï¼Œç›´åˆ°é‡åˆ°æ¢è¡Œç¬¦
```

`streambuf` ä½¿å¾—æµå¼æ•°æ®çš„å¤„ç†æ›´åŠ çµæ´»ï¼Œä½ å¯ä»¥é€è¡Œã€é€å­—èŠ‚åœ°è¯»å†™æ•°æ®ã€‚

### 7. **æ€»ç»“ä¸æ‹“å±•**

- **`buffer()` å‡½æ•°**ï¼šç®€åŒ–äº† `mutable_buffer` å’Œ `const_buffer` çš„ç®¡ç†ï¼Œä½¿å¾—ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒç»†èŠ‚ã€‚å®ƒè‡ªåŠ¨æ ¹æ®æ•°æ®ç±»å‹ç”Ÿæˆé€‚åˆçš„ç¼“å†²åŒºã€‚
- **`asio::streambuf`**ï¼šæä¾›äº†ä¸€ç§æ›´é«˜å±‚çš„æµå¼æ•°æ®å¤„ç†æ–¹å¼ï¼Œé€‚ç”¨äºéœ€è¦é€æ­¥è¯»å–å’Œå†™å…¥æ•°æ®çš„åœºæ™¯ã€‚
- **æ€§èƒ½ä¼˜åŒ–**ï¼šBoost Asio çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯é«˜æ•ˆå¤„ç†å¤§é‡æ•°æ®ä¼ è¾“ã€‚é€šè¿‡å°†å¤šä¸ªç¼“å†²åŒºç»„åˆæˆ `MutableBufferSequence` æˆ– `ConstBufferSequence`ï¼Œå®ƒèƒ½å¤Ÿå‡å°‘å†…å­˜å¤åˆ¶ï¼Œæå‡æ€§èƒ½ã€‚

é€šè¿‡è¿™äº›å·¥å…·ï¼ŒBoost Asio æä¾›äº†ä¸€ç§é«˜æ•ˆä¸”çµæ´»çš„æ–¹å¼æ¥å¤„ç†ç½‘ç»œé€šä¿¡ä¸­çš„æ•°æ®ä¼ è¾“å’Œç¼“å†²åŒºç®¡ç†ã€‚ç†è§£è¿™äº›æ•°æ®ç»“æ„çš„å·¥ä½œåŸç†ä»¥åŠå¦‚ä½•ä¸ API é…åˆä½¿ç”¨ï¼Œå°†å¸®åŠ©ä½ åœ¨é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹ä¸­è·å¾—æ›´å¥½çš„æ§åˆ¶ä¸æ•ˆç‡ã€‚











# æˆ‘çš„ç–‘é—®çš„ä¸€äº›è§£ç­”ï¼š
å¥½çš„ï¼Œæˆ‘æ¥ç”¨æ›´é€šä¿—çš„æ–¹å¼è§£é‡Šè¿™äº›é—®é¢˜ï¼Œå¹¶è¡¥å……ç›¸å…³ç»†èŠ‚ï¼š

---

### ä¸€ã€Socket çš„é€šä¿—ç†è§£
**æƒ³è±¡åœºæ™¯**ï¼šæ‰“ç”µè¯çš„è¿‡ç¨‹
1. **Socketï¼ˆé€šä¿¡socketï¼‰**ï¼šç›¸å½“äºä½ æ‰‹ä¸­çš„æ‰‹æœº
   - ç”¨æ¥å’Œåˆ«äººé€šè¯ï¼ˆä¼ è¾“æ•°æ®ï¼‰
   - å¿…é¡»çŸ¥é“å¯¹æ–¹çš„å·ç ï¼ˆIPåœ°å€+ç«¯å£ï¼‰æ‰èƒ½æ‹¨æ‰“ï¼ˆconnectï¼‰
   - é€šè¯ç»“æŸåè¦æŒ‚æ–­ï¼ˆcloseï¼‰

2. **Acceptorï¼ˆç›‘å¬socketï¼‰**ï¼šç›¸å½“äºå…¬å¸å‰å°çš„æ€»æœº
   - ä¸“é—¨è´Ÿè´£æ¥å¬æ¥ç”µï¼ˆç›‘å¬ç«¯å£ï¼‰
   - å½“æœ‰ç”µè¯è¿›æ¥æ—¶ï¼Œæ€»æœºä¼šè½¬æ¥ç»™åŒäº‹çš„åˆ†æœºï¼ˆacceptç”Ÿæˆæ–°çš„é€šä¿¡socketï¼‰
   - æ€»æœºæœ¬èº«ä¸å‚ä¸é€šè¯ï¼Œåªè´Ÿè´£è½¬æ¥

**å…³é”®åŒºåˆ«**ï¼š
- ä½ æ‰‹ä¸­çš„æ‰‹æœºï¼ˆé€šä¿¡socketï¼‰å¯ä»¥ä¸»åŠ¨æ‹¨æ‰“ï¼Œä¹Ÿå¯ä»¥è¢«åŠ¨æ¥å¬
- å…¬å¸æ€»æœºï¼ˆAcceptorï¼‰æ°¸è¿œæ˜¯è¢«åŠ¨ç­‰å¾…æ¥ç”µçš„

---

### äºŒã€IPv6åŒæ ˆæ”¯æŒï¼ˆIPv4-mapped IPv6ï¼‰
#### å“ªäº›ç³»ç»Ÿæ”¯æŒï¼Ÿ
| ç³»ç»Ÿç±»å‹       | æ˜¯å¦æ”¯æŒ                  | æ£€æŸ¥æ–¹æ³•                     |
|----------------|-------------------------|----------------------------|
| **Linux (Ubuntu)** | é»˜è®¤æ”¯æŒï¼ˆéœ€å†…æ ¸é…ç½®ï¼‰       | `cat /proc/sys/net/ipv6/bindv6only` â†’ åº”ä¸º `0` |
| **Windows**    | VistaåŠä»¥ä¸Šæ”¯æŒ           | é»˜è®¤å¼€å¯                     |
| **macOS**      | 10.12 SierraåŠä»¥ä¸Šæ”¯æŒ    | é»˜è®¤å¼€å¯                     |

#### å¦‚ä½•ä½¿ç”¨ï¼Ÿ
1. **æœåŠ¡ç«¯**ï¼šåªéœ€ç›‘å¬IPv6åœ°å€
   ```cpp
   // ç›‘å¬æ‰€æœ‰IPv6åœ°å€ï¼ˆåŒæ—¶æ¥å—IPv4è¿æ¥ï¼‰
   asio::ip::tcp::endpoint ep(asio::ip::address_v6::any(), 8080);
   acceptor.bind(ep);
   ```

2. **å®¢æˆ·ç«¯è¿æ¥IPv4åœ°å€**ï¼š
   ```cpp
   // IPv4åœ°å€ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸º ::ffff:192.168.1.1
   asio::connect(sock, asio::ip::tcp::resolver::resolve("192.168.1.1", "8080"));
   ```

#### å…³é—­åŒæ ˆæ”¯æŒï¼š
```bash
# Linux ä¸­å…³é—­ï¼ˆä»…é™IPv6ï¼‰
sudo sysctl -w net.ipv6.bindv6only=1
```

---

	å…³äº `io_context` å®ä¾‹çš„æ•°é‡é€‰æ‹©ï¼Œå–å†³äº**åº”ç”¨åœºæ™¯çš„è®¾è®¡ç›®æ ‡**ã€‚ä»¥ä¸‹æ˜¯ä¸åŒåœºæ™¯ä¸‹çš„æœ€ä½³å®è·µå’Œè¯¦ç»†è§£é‡Šï¼š

---

### ä¸‰ã€ä»€ä¹ˆæ—¶å€™åªéœ€è¦ **ä¸€ä¸ª** `io_context` å®ä¾‹ï¼Ÿ
#### 1. **å•çº¿ç¨‹åº”ç”¨**
   - æ‰€æœ‰I/Oæ“ä½œåœ¨å•ä¸ªçº¿ç¨‹ä¸­å¤„ç†ï¼Œé€šè¿‡ `io_context::run()` é©±åŠ¨äº‹ä»¶å¾ªç¯ã€‚
   - **ä¼˜ç‚¹**ï¼šç®€å•ã€æ— é”ã€æ— å¹¶å‘å†²çªã€‚
   - **ç¤ºä¾‹**ï¼šç®€å•çš„å®¢æˆ·ç«¯å·¥å…·æˆ–ä½å¹¶å‘çš„æœåŠ¡ç«¯ã€‚

#### 2. **å¤šçº¿ç¨‹å…±äº«ä¸€ä¸ª `io_context`**
   - **å¤šä¸ªçº¿ç¨‹è°ƒç”¨ `io_context::run()`**ï¼Œå½¢æˆå¤šçº¿ç¨‹äº‹ä»¶å¾ªç¯ã€‚
   - **ä¼˜ç‚¹**ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œæå‡å¹¶å‘æ€§èƒ½ã€‚
   - **å…³é”®ç‚¹**ï¼š
     - Asioä¿è¯**å®Œæˆå¤„ç†å™¨ï¼ˆCompletion Handlersï¼‰** çš„çº¿ç¨‹å®‰å…¨ï¼ˆå³å¼‚æ­¥æ“ä½œçš„å›è°ƒå‡½æ•°ä¼šæ­£ç¡®åŒæ­¥ï¼‰ã€‚
     - ä½†ç”¨æˆ·è‡ªå®šä¹‰çš„å…±äº«æ•°æ®ä»éœ€åŠ é”ï¼ˆå¦‚ `std::mutex`ï¼‰ã€‚
   - **é€‚ç”¨åœºæ™¯**ï¼šé«˜å¹¶å‘æœåŠ¡ç«¯ï¼ˆå¦‚WebæœåŠ¡å™¨ï¼‰ã€‚

   ```cpp
   asio::io_context io;
   
   // å¯åŠ¨4ä¸ªå·¥ä½œçº¿ç¨‹å¤„ç†äº‹ä»¶å¾ªç¯
   std::vector<std::thread> threads;
   for (int i = 0; i < 4; ++i) {
       threads.emplace_back([&io] { io.run(); });
   }
   
   // ä¸»çº¿ç¨‹ç»§ç»­æäº¤å¼‚æ­¥æ“ä½œ...
   ```

---

### å››ã€ä»€ä¹ˆæ—¶å€™éœ€è¦ **å¤šä¸ª** `io_context` å®ä¾‹ï¼Ÿ
#### 1. **éš”ç¦»ä¸åŒç±»å‹çš„I/O**
   - ä¸ºä¸åŒç±»åˆ«çš„I/Oæ“ä½œåˆ†é…ç‹¬ç«‹çš„ `io_context`ï¼Œé¿å…ç›¸äº’é˜»å¡ã€‚
   - **å¸¸è§åˆ†å‰²æ–¹å¼**ï¼š
     - **ç½‘ç»œI/O** vs **æ–‡ä»¶I/O**ï¼ˆæ–‡ä»¶æ“ä½œå¯èƒ½é˜»å¡è¾ƒä¹…ï¼‰ã€‚
     - **é«˜ä¼˜å…ˆçº§ä»»åŠ¡** vs **ä½ä¼˜å…ˆçº§ä»»åŠ¡**ã€‚
   - **ç¤ºä¾‹**ï¼š
     ```cpp
     asio::io_context net_io;  // å¤„ç†ç½‘ç»œè¯·æ±‚
     asio::io_context file_io; // å¤„ç†æ–‡ä»¶è¯»å†™
     ```

#### 2. **å¤šæ ¸CPUä¸‹çš„ä¸“ç”¨çº¿ç¨‹æ± **
   - æ¯ä¸ª `io_context` ç»‘å®šåˆ°ç‰¹å®šçš„CPUæ ¸å¿ƒï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢å¼€é”€ã€‚
   - **é€‚ç”¨åœºæ™¯**ï¼šè¶…é«˜æ€§èƒ½æœåŠ¡å™¨ï¼ˆå¦‚é«˜é¢‘äº¤æ˜“ç³»ç»Ÿï¼‰ã€‚
   - **ç¤ºä¾‹**ï¼š
     ```cpp
     // æ¯ä¸ª io_context ç”±ä¸€ä¸ªä¸“ç”¨çº¿ç¨‹é©±åŠ¨
     std::vector<asio::io_context> ios_list(4);
     std::vector<std::thread> threads;
     
     for (int i = 0; i < 4; ++i) {
         threads.emplace_back([&ios = ios_list[i]] { ios.run(); });
     }
     ```

#### 3. **é•¿æ—¶é—´é˜»å¡æ“ä½œ**
   - è‹¥æŸäº›æ“ä½œæ— æ³•å¼‚æ­¥åŒ–ï¼ˆå¦‚ç¬¬ä¸‰æ–¹é˜»å¡åº“ï¼‰ï¼Œå¯å°†å®ƒä»¬éš”ç¦»åˆ°ç‹¬ç«‹çš„ `io_context`ï¼Œé¿å…é˜»å¡ä¸»äº‹ä»¶å¾ªç¯ã€‚
   - **ç¤ºä¾‹**ï¼š
     ```cpp
     asio::io_context main_io;  // ä¸»å¾ªç¯
     asio::io_context block_io; // å¤„ç†é˜»å¡æ“ä½œ
     
     // åœ¨ block_io ä¸­è¿è¡Œé˜»å¡ä»»åŠ¡
     std::thread([&block_io] {
         block_io.run();
     }).detach();
     ```

---

### ä¸‰ã€å…³é”®å¯¹æ¯”è¡¨
| **åœºæ™¯**                    | **å•å®ä¾‹** | **å¤šå®ä¾‹**             |
|-----------------------------|------------|-----------------------|
| **å•çº¿ç¨‹ç®€å•åº”ç”¨**           | âœ… æœ€ä½³é€‰æ‹© | âŒ å¢åŠ å¤æ‚æ€§           |
| **å¤šçº¿ç¨‹é«˜å¹¶å‘**             | âœ… æ¨è     | âŒ å¯èƒ½æµªè´¹èµ„æº         |
| **éš”ç¦»I/Oç±»å‹ï¼ˆç½‘ç»œ/æ–‡ä»¶ï¼‰** | âŒ ä¸é€‚ç”¨   | âœ… å¿…é¡»ä½¿ç”¨             |
| **ä¸“ç”¨CPUæ ¸å¿ƒç»‘å®š**          | âŒ ä¸é€‚ç”¨   | âœ… å¿…é¡»ä½¿ç”¨             |
| **å¤„ç†é˜»å¡æ“ä½œ**             | âŒ ä¸é€‚ç”¨   | âœ… å¿…é¡»ä½¿ç”¨             |

---

### å››ã€å®é™…æ¡ˆä¾‹å‚è€ƒ
#### æ¡ˆä¾‹1ï¼šWebæœåŠ¡å™¨ï¼ˆå¤šçº¿ç¨‹å•å®ä¾‹ï¼‰
- **è®¾è®¡**ï¼šä¸€ä¸ª `io_context`ï¼Œ4ä¸ªå·¥ä½œçº¿ç¨‹è°ƒç”¨ `run()`ã€‚
- **ä¼˜ç‚¹**ï¼šé«˜æ•ˆå¤„ç†HTTPè¯·æ±‚ï¼Œå…±äº«åŒä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—ã€‚

#### æ¡ˆä¾‹2ï¼šå®æ—¶éŸ³è§†é¢‘ä¼ è¾“ç³»ç»Ÿ
- **è®¾è®¡**ï¼š
  - `net_io`ï¼šå¤„ç†ä½å»¶è¿Ÿçš„éŸ³è§†é¢‘æµã€‚
  - `file_io`ï¼šå¤„ç†æ—¥å¿—å†™å…¥å’Œæ–‡ä»¶å­˜å‚¨ã€‚
- **ä¼˜ç‚¹**ï¼šæ–‡ä»¶æ“ä½œçš„å»¶è¿Ÿä¸ä¼šå½±å“å®æ—¶æµä¼ è¾“ã€‚

---

### äº”ã€æœ€ä½³å®è·µå»ºè®®
1. **é»˜è®¤é€‰æ‹©å•å®ä¾‹**ï¼šé™¤éæœ‰æ˜ç¡®éœ€æ±‚ï¼ˆå¦‚éš”ç¦»é˜»å¡æ“ä½œï¼‰ï¼Œå¦åˆ™ä¼˜å…ˆä½¿ç”¨å•ä¸ª `io_context`ã€‚
2. **å¤šçº¿ç¨‹ä¼˜åŒ–**ï¼šé€šè¿‡å¤šçº¿ç¨‹è°ƒç”¨ `run()` æå‡æ€§èƒ½ï¼Œè€Œéåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚
3. **èµ„æºéš”ç¦»**ï¼šè‹¥éœ€å¤„ç†æ··åˆI/Oç±»å‹ï¼ˆå¦‚ç½‘ç»œ+ä¸²å£ï¼‰ï¼Œä½¿ç”¨å¤šå®ä¾‹éš”ç¦»ã€‚
4. **æ€§èƒ½æµ‹è¯•**ï¼šé€šè¿‡å‹åŠ›æµ‹è¯•éªŒè¯å®ä¾‹æ•°é‡çš„å½±å“ï¼Œé¿å…è¿‡æ—©ä¼˜åŒ–ã€‚

---

å¦‚æœå…·ä½“åœºæ™¯ä»æœ‰ç–‘é—®ï¼ˆæ¯”å¦‚å¦‚ä½•é€‰æ‹©çº¿ç¨‹æ•°ï¼‰ï¼Œæ¬¢è¿è¿›ä¸€æ­¥è®¨è®ºï¼